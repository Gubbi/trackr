<!--
@license
Copyright (c) 2015 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">

<dom-module id="upload-entry">
  <style>
    paper-card {
      width: 100%;
      border-top: 2px solid #fefefe;
      background-color: white;
    }
    .card-content {
      padding: 8px 16px;
      font-size: 0.8em;
    }
    .upload_id {
      width: 150px;
    }
    .amount {
      width: 60px;
    }
    .payer_num {
      width: 80px;
    }
    .total_rows {
      width: 90px;
    }
    .download_url {
      width: 72px;
    }
  </style>
  <template>
    <paper-card>
      <div>
        <div class="card-content horizontal layout center flex">
          <div class="upload_id">{{key}}</div><span class="flex"></span>
          <div class="total_rows">{{job.rows}}</div><span class="flex"></span>
          <div class="codes">{{job.codes}}</div><span class="flex"></span>
          <div class="amount">â‚¹{{job.amount}}</div><span class="flex"></span>
          <div class="download_url"><a href="{{job.url}}">Link</a></div>
          <div class="name">{{job.name}}</div>
          <paper-icon-button class="actions" title="Create KyashCodes" icon="flight-takeoff" on-tap="create"></paper-icon-button>
        </div>
      </div>
    </paper-card>
  </template>

  <script>
    (function() {
      Polymer({
        is: 'upload-entry',

        properties: {
          job: Object,
          key: String
        },

        create: function () {
          var _this = this;
          superagent.post('/bkend/codes')
          .auth(fbase.api_id, '')
          .type('form')
          .send({
            id: this.key
          })
          .end(function(err, res) {
            if(res.ok) {
              _this.show_success('');
            } else {
              _this.show_error(res.body.message);
            }
          });
        },

        show_success: function(message) {
          this.successMessage = message;
          this.$.successMsg.show();
        },

        show_error: function(message) {
          this.errorMessage = message;
          this.$.errorMsg.open();
        }
      });
    })();
  </script>
</dom-module>
